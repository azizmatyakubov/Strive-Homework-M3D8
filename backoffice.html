<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">

    <title>BackOffice</title>
  </head>
  <body>

    <div class="container">

        <nav class="navbar navbar-expand-lg navbar-light bg-light">
            
              <a class="navbar-brand" href="./index.html">Home</a>
              <a class="navbar-brand fw-bold" href="./backoffice.html">BackOffice</a>
   
          </nav>


    <form class="d-flex flex-column mt-5 align-items-center justify-content-center row g-3" onsubmit="handleSubmit(event)">
        <input class="form-control form-control w-50" placeholder="Type phone name.." type="text" name="name" id="name">
        <input class="form-control form-control w-50" placeholder="Type phone description.." type="text" name="description" id="description">
        <input class="form-control form-control w-50" placeholder="Type phone brand" type="text" name="brand" id="brand">
        <input class="form-control form-control w-50" placeholder="Paste image link.." type="link" src="img" alt="img" id="image">
        <input class="form-control form-control w-50" placeholder="Type phone price.." type="number" name="price" id="price">
        <button class="w-50 btn btn-success" id="submit" type="submit">Submit</button>
        <button class="d-none w-50 btn btn-info text-light" id="edit" >EDIT</button>
        <button type="button" class="d-none w-50 btn btn-danger text-light" id="delete" onclick="handleDelete()">DELETE</button>
    </form>
</div>
    <!-- Optional JavaScript; choose one of the two! -->

    <!-- Option 1: Bootstrap Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>

    <!-- Option 2: Separate Popper and Bootstrap JS -->
    <!--
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.10.2/dist/umd/popper.min.js" integrity="sha384-7+zCNj/IqJ95wo16oMtfsKbZ9ccEh31eOz1HGyDuCQ6wgnyJNSYdrPa03rtR1zdB" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.min.js" integrity="sha384-QJHtvGhmr9XOIpI6YVutG+2QOK9T+ZnN4kzFN1RtK3zEFEIsxhlmWl5/YESvpZ13" crossorigin="anonymous"></script>
    -->
  </body>
  <script>
        const name = document.querySelector('#name')
        const description = document.querySelector('#description')
        const brand = document.querySelector('#brand')
        const image = document.querySelector('#image')
        const price=document.querySelector('#price')

        // buttons 
        const buttonSubmit = document.querySelector('#submit')
        const buttonEdit = document.querySelector('#edit')
        const buttonDelete = document.querySelector('#delete')

        // ID 
        let id = new URLSearchParams(window.location.search).get('id')
        console.log(id)


        window.onload = async () => {
        
          if(id) {

            // Hide submit button
            // Display Edit and Delete button

            buttonSubmit.classList.add('d-none')
            buttonEdit.classList.remove('d-none')
            buttonDelete.classList.remove('d-none')


            // Display selected product
            try {
                const response = await fetch("https://striveschool-api.herokuapp.com/api/product/" + id,{
                headers: {
                    "Authorization": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJfaWQiOiI2MjI4YWU0NDRlYTdiMTAwMTVkMDY3YTciLCJpYXQiOjE2NDY4MzgzOTksImV4cCI6MTY0ODA0Nzk5OX0.ddOI9v-LkcJC6WLJVMQWOXR66cKJ9yHLn3szHYpHa40"
                    },
                });
                
                const data = await response.json();
                console.log(data)
                
                name.value = data.name
                description.value = data.description
                brand.value = data.brand
                image.value = data.imageUrl
                price.value = data.price



            } catch (error) {
                console.log(error)
            }
          }
      }

// When submit button clicked, it send POST request to server 
const handleSubmit = async (event) => {
    event.preventDefault()
        
    try {
            
        //Creating object body
        const bodyObj={
                name:name.value,
                description:description.value,
                brand:brand.value,
                imageUrl:image.value,
                price: price.value,
            }

        const body=JSON.stringify(bodyObj)
        console.log(body)


        const endpoint =
                id
                    ? "https://striveschool-api.herokuapp.com/api/product/" + id
                    : "https://striveschool-api.herokuapp.com/api/product/"

        const method =
                id
                    ? "PUT" // "PATCH"
                    : "POST"


        //Sending POST request
        const response= await fetch (endpoint,
            {
                method: method,
                headers:{
                    "Authorization": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJfaWQiOiI2MjI4YWU0NDRlYTdiMTAwMTVkMDY3YTciLCJpYXQiOjE2NDY4MzgzOTksImV4cCI6MTY0ODA0Nzk5OX0.ddOI9v-LkcJC6WLJVMQWOXR66cKJ9yHLn3szHYpHa40",
                    'Content-type': 'application/json',
                },
                body:body
            })

            if(response.ok){
                const data=await response.json()
                alert('Uploaded')
                document.location.assign('./index.html')
            } else{
                alert('Come on, try again. You are missing some code')
            }

    } catch (error) {
            console.log(error)
        }
      }

//Delete selected product
const handleDelete = async () => {

    if (confirm("Are you sure you want to delete this event?")) {

        const response = await fetch("https://striveschool-api.herokuapp.com/api/product/" + id, {
            headers: {
                "Authorization": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJfaWQiOiI2MjI4YWU0NDRlYTdiMTAwMTVkMDY3YTciLCJpYXQiOjE2NDY4MzgzOTksImV4cCI6MTY0ODA0Nzk5OX0.ddOI9v-LkcJC6WLJVMQWOXR66cKJ9yHLn3szHYpHa40"
                },
            method: 'DELETE'
        })

        if (response.ok) {
            alert("Success! The event was successfully deleted!")
            window.location.href = "/index.html"
        } else {
            alert("Something went wrong. Please try again later")
        }

    }
}

</script>


</html>